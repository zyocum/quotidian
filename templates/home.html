{% extends "base.html" %}
{% block content %}
<div class="center">
<h1 class="page-title">Enter Hours</h1>
<p>Push record to talk.</p>

      <form id="user_input">
          <div align="center">
              <input
                  id="record_button"
                  type="button"
                  class="btn btn-danger"
                  value="Record"
              >
                  <span id="time"></span>
              </input>
              <input
                  id="user_text"
                  type="text"
                  size="25"
                  value="I worked â€¦"
                  <--onKeyPress="submitenter(this,event); return false;"-->
           
              <input
                  id="submit_button"
                  onClick="pushTime(); return false;"
                  class="btn btn-danger"
                  type="submit"
                  value="Submit"
              >
              <input
                  id="interval"
                  type="hidden"
                  value="T8:0:0Z/T17:0:0Z"
              >
              <p></p>
              <div id="myDiv"></div>
			  <p></p>
			  <input
                  id="previous_day"
                  onClick="previousDay(); unfillHours();  pullTime(); return false;"
                  class="btn"
                  type="button"
                  value="<"
                  onKeyPress="keypress(this,event); return false;"
              >
              <input
                  id="clear"
                  onClick="clearTime(); unfillHours(); return false;"
                  class="btn"
                  type="button"
                  value="Clear Hours"
              >
              <input
                  id="next_day"
                  onClick="nextDay(); unfillHours(); pullTime(); return false;"
                  class="btn"
                  type="button"
                  value=">"
                  onKeyPress="keypress(this,event); return false;"
              >
          </div>
      </form>
</div>

<center>
    <div id="calendar"></div>
</center>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/record.js') }}"></script>
<script src="{{ url_for('static', filename='js/calendar.js') }}"></script>
<script>
	// CALL THIS WHEN YOU SUBMIT TIME
    function pushTime()
    {
        var req = new XMLHttpRequest()
        req.onreadystatechange = function()
        {
            if (req.readyState == 4)
            {
                if (req.status != 200)
                {
                    //error handling code here
                }
                else
                {
					//get request - data returned by app.py
                    var response = JSON.parse(req.responseText)
                    //document.getElementById('myDiv').innerHTML = response.interval //display get
					// HOOK INTO CALENDAR GUI HERE
					var start = parseInt(response.interval.split('/')[0].split('T')[1].split(':')[0])-1,
					end = parseInt(response.interval.split('/')[1].split('T')[1].split(':')[0])-1;
			        setRange(start, end, 'worked', 'notworked');
                }
            }
        }
		//post reqest - data sent to app.py
        req.open('POST', '/push_time');
        req.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        var transcription = document.getElementById('user_text').value;
        var postVars = 'transcription='+transcription+'&date='+today.toString();
        req.send(postVars);
        return false;
    }
	
	// CALL THIS WHEN YOU CHANGE DAY
    function pullTime()
    {
        var req = new XMLHttpRequest()
        req.onreadystatechange = function()
        {
            if (req.readyState == 4)
            {
                if (req.status != 200)
                {
                    //error handling code here
                }
                else
                {
					//get request - data returned by app.py
                    var response = JSON.parse(req.responseText)
                    //document.getElementById('myDiv').innerHTML = response.interval //display get
					// HOOK INTO CALENDAR GUI HERE
					var start = parseInt(response.interval.split('/')[0].split('T')[1].split(':')[0])-1,
					end = parseInt(response.interval.split('/')[1].split('T')[1].split(':')[0])-1;
			        setRange(start, end, 'worked', 'notworked');
                }
            }
        }
		//post reqest - data sent to app.py
        req.open('POST', '/pull_time');
        req.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        var postVars = 'date='+today.toString();
        req.send(postVars);
        return false;
    }

	// CALL THIS WHEN YOU CLEAR DAY
    function clearTime()
    {
        var req = new XMLHttpRequest()
        req.onreadystatechange = function()
        {
            if (req.readyState == 4)
            {
                if (req.status != 200)
                {
                    //error handling code here
                }
                else
                {
					//get request - data returned by app.py
                    var response = JSON.parse(req.responseText)
                    //document.getElementById('myDiv').innerHTML = response.interval //display get
                }
            }
        }
		//post reqest - data sent to app.py
        req.open('POST', '/clear_time');
        req.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        var postVars = 'date='+today.toString();
        req.send(postVars);
        return false;
    }

</script>
{% endblock scripts %}
